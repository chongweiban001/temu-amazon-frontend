{% extends 'layout.html' %}

{% block page_title %}控制中心 - 亚马逊-Temu跨境选品分析系统{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <!-- 顶部统计卡片 -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-primary shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">总产品数</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ total_products|default(2458) }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="bi bi-box-seam fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-success shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">高潜力产品</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ high_potential_products|default(168) }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="bi bi-graph-up-arrow fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">待上传产品</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ pending_uploads|default(42) }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="bi bi-cloud-upload fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-warning shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">高风险产品</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ high_risk_products|default(23) }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="bi bi-exclamation-triangle fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 系统状态和图表区域 -->
    <div class="row">
        <!-- 左侧列 - 系统状态和快速操作 -->
        <div class="col-lg-4">
            <!-- 系统状态 -->
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="bi bi-check2-circle me-2"></i>系统状态
                    </h6>
                    <div class="dropdown no-arrow">
                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown">
                            <i class="bi bi-three-dots-vertical text-gray-400"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in">
                            <a class="dropdown-item" href="#"><i class="bi bi-arrow-repeat me-2"></i>刷新状态</a>
                            <a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i>设置</a>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <!-- 状态指示器列表 -->
                    <div class="status-list">
                        {% for module, status in modules_status.items() %}
                        <div class="status-item d-flex align-items-center mb-3">
                            <div class="status-indicator me-3 {% if status == 'active' %}bg-success{% else %}bg-danger{% endif %}"></div>
                            <div class="status-content">
                                <h6 class="mb-0">{{ module }}</h6>
                                <small class="text-muted">{{ '正常运行中' if status == 'active' else '当前离线' }}</small>
                            </div>
                            <div class="ms-auto">
                                <a href="#" class="btn btn-sm btn-light">
                                    <i class="bi bi-arrow-clockwise"></i>
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- 快速操作 -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="bi bi-lightning me-2"></i>快速操作
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row quick-actions">
                        <div class="col-6 mb-3">
                            <a href="{{ url_for('crawl') }}" class="btn btn-primary btn-block">
                                <i class="bi bi-cloud-download me-2"></i>开始抓取
                            </a>
                        </div>
                        <div class="col-6 mb-3">
                            <a href="{{ url_for('advanced_selection') }}" class="btn btn-success btn-block">
                                <i class="bi bi-search me-2"></i>智能选品
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="{{ url_for('profit_calculator') }}" class="btn btn-info btn-block">
                                <i class="bi bi-calculator me-2"></i>利润计算
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="{{ url_for('temu_integration') }}" class="btn btn-warning btn-block">
                                <i class="bi bi-upload me-2"></i>上传产品
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 中央列 - 图表 -->
        <div class="col-lg-8">
            <div class="row">
                <!-- BSR趋势图 -->
                <div class="col-12 mb-4">
                    <div class="card shadow">
                        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                            <h6 class="m-0 font-weight-bold text-primary">
                                <i class="bi bi-graph-up me-2"></i>类目BSR趋势
                            </h6>
                            <div class="dropdown no-arrow">
                                <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown">
                                    <i class="bi bi-three-dots-vertical text-gray-400"></i>
                                </a>
                                <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in">
                                    <a class="dropdown-item active" href="#">电子产品</a>
                                    <a class="dropdown-item" href="#">家居用品</a>
                                    <a class="dropdown-item" href="#">厨房用品</a>
                                    <div class="dropdown-divider"></div>
                                    <a class="dropdown-item" href="#">全部类目</a>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="chart-area">
                                <canvas id="bsrTrendChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 左侧小图表 -->
                <div class="col-md-6 mb-4">
                    <div class="card shadow h-100">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">
                                <i class="bi bi-pie-chart me-2"></i>类目分布
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="chart-pie pt-2">
                                <canvas id="categoryPieChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 右侧小图表 -->
                <div class="col-md-6 mb-4">
                    <div class="card shadow h-100">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">
                                <i class="bi bi-bar-chart me-2"></i>评分分布
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="chart-bar">
                                <canvas id="ratingBarChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 功能区域和最近活动 -->
    <div class="row">
        <!-- 功能模块卡片 -->
        <div class="col-lg-8">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="bi bi-tools me-2"></i>核心功能
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <!-- 数据采集 -->
                        <div class="col-md-4 col-sm-6">
                            <div class="card feature-card h-100">
                                <div class="card-body text-center">
                                    <i class="bi bi-cloud-download feature-icon text-primary"></i>
                                    <h5 class="card-title">数据采集</h5>
                                    <p class="card-text small">从亚马逊获取产品数据，支持多区域、多类别采集</p>
                                    <a href="{{ url_for('crawl') }}" class="btn btn-sm btn-primary mt-2">开始采集</a>
                                </div>
                            </div>
                        </div>
                        <!-- 智能选品 -->
                        <div class="col-md-4 col-sm-6">
                            <div class="card feature-card h-100">
                                <div class="card-body text-center">
                                    <i class="bi bi-lightning-charge feature-icon text-warning"></i>
                                    <h5 class="card-title">智能选品</h5>
                                    <p class="card-text small">基于多维度数据分析，智能推荐潜力产品</p>
                                    <a href="{{ url_for('advanced_selection') }}" class="btn btn-sm btn-primary mt-2">开始选品</a>
                                </div>
                            </div>
                        </div>
                        <!-- 数据可视化 -->
                        <div class="col-md-4 col-sm-6">
                            <div class="card feature-card h-100">
                                <div class="card-body text-center">
                                    <i class="bi bi-graph-up feature-icon text-success"></i>
                                    <h5 class="card-title">数据可视化</h5>
                                    <p class="card-text small">多维度图表分析，展示产品趋势和市场洞察</p>
                                    <a href="{{ url_for('visualization') }}" class="btn btn-sm btn-primary mt-2">查看分析</a>
                                </div>
                            </div>
                        </div>
                        <!-- 产品比较 -->
                        <div class="col-md-4 col-sm-6">
                            <div class="card feature-card h-100">
                                <div class="card-body text-center">
                                    <i class="bi bi-clipboard-check feature-icon text-info"></i>
                                    <h5 class="card-title">产品比较</h5>
                                    <p class="card-text small">多产品对比分析，找出最具潜力的选品方向</p>
                                    <a href="{{ url_for('compare') }}" class="btn btn-sm btn-primary mt-2">开始比较</a>
                                </div>
                            </div>
                        </div>
                        <!-- 利润计算 -->
                        <div class="col-md-4 col-sm-6">
                            <div class="card feature-card h-100">
                                <div class="card-body text-center">
                                    <i class="bi bi-calculator feature-icon text-danger"></i>
                                    <h5 class="card-title">利润计算</h5>
                                    <p class="card-text small">全面利润分析，考虑运费、税费、平台佣金等</p>
                                    <a href="{{ url_for('profit_calculator') }}" class="btn btn-sm btn-primary mt-2">计算利润</a>
                                </div>
                            </div>
                        </div>
                        <!-- Temu集成 -->
                        <div class="col-md-4 col-sm-6">
                            <div class="card feature-card h-100">
                                <div class="card-body text-center">
                                    <i class="bi bi-upload feature-icon text-secondary"></i>
                                    <h5 class="card-title">Temu集成</h5>
                                    <p class="card-text small">一键将选定产品上传至Temu平台，简化上架流程</p>
                                    <a href="{{ url_for('temu_integration') }}" class="btn btn-sm btn-primary mt-2">Temu上传</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 最近活动 -->
        <div class="col-lg-4">
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="bi bi-clock-history me-2"></i>最近活动
                    </h6>
                    <a href="#" class="btn btn-sm btn-primary">
                        <i class="bi bi-list-ul"></i> 查看全部
                    </a>
                </div>
                <div class="card-body p-0">
                    <div class="activity-list">
                        <div class="activity-item p-3 border-bottom">
                            <div class="d-flex align-items-center mb-1">
                                <span class="activity-icon bg-success me-3">
                                    <i class="bi bi-check-lg text-white"></i>
                                </span>
                                <div>
                                    <h6 class="mb-0">系统启动</h6>
                                    <small class="text-muted">{{ datetime.now().strftime('%Y-%m-%d %H:%M:%S') }}</small>
                                </div>
                                <span class="badge bg-success ms-auto">成功</span>
                            </div>
                        </div>
                        <div class="activity-item p-3 border-bottom">
                            <div class="d-flex align-items-center mb-1">
                                <span class="activity-icon bg-success me-3">
                                    <i class="bi bi-arrow-repeat text-white"></i>
                                </span>
                                <div>
                                    <h6 class="mb-0">数据更新</h6>
                                    <small class="text-muted">{{ (datetime.now().replace(minute=datetime.now().minute-5)).strftime('%Y-%m-%d %H:%M:%S') }}</small>
                                </div>
                                <span class="badge bg-success ms-auto">成功</span>
                            </div>
                        </div>
                        <div class="activity-item p-3 border-bottom">
                            <div class="d-flex align-items-center mb-1">
                                <span class="activity-icon bg-warning me-3">
                                    <i class="bi bi-cloud-upload text-white"></i>
                                </span>
                                <div>
                                    <h6 class="mb-0">产品上传至Temu</h6>
                                    <small class="text-muted">{{ (datetime.now().replace(hour=datetime.now().hour-1)).strftime('%Y-%m-%d %H:%M:%S') }}</small>
                                </div>
                                <span class="badge bg-warning ms-auto">部分成功</span>
                            </div>
                        </div>
                        <div class="activity-item p-3">
                            <div class="d-flex align-items-center mb-1">
                                <span class="activity-icon bg-info me-3">
                                    <i class="bi bi-search text-white"></i>
                                </span>
                                <div>
                                    <h6 class="mb-0">智能选品分析</h6>
                                    <small class="text-muted">{{ (datetime.now().replace(hour=datetime.now().hour-2)).strftime('%Y-%m-%d %H:%M:%S') }}</small>
                                </div>
                                <span class="badge bg-info ms-auto">完成</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block styles %}
<style>
    /* 状态指示器样式 */
    .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
    }
    
    /* 活动图标样式 */
    .activity-icon {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    /* 卡片边框颜色 */
    .border-left-primary {
        border-left: 4px solid #4e73df !important;
    }
    
    .border-left-success {
        border-left: 4px solid #1cc88a !important;
    }
    
    .border-left-info {
        border-left: 4px solid #36b9cc !important;
    }
    
    .border-left-warning {
        border-left: 4px solid #f6c23e !important;
    }
    
    /* 功能卡片样式 */
    .feature-card {
        transition: all 0.3s ease;
    }
    
    .feature-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    }
    
    .feature-icon {
        font-size: 2rem;
        margin-bottom: 0.5rem;
    }
    
    /* 图表区域样式 */
    .chart-area {
        position: relative;
        height: 300px;
        width: 100%;
    }
    
    .chart-pie, .chart-bar {
        position: relative;
        height: 250px;
        width: 100%;
    }
    
    /* 快速操作按钮 */
    .btn-block {
        width: 100%;
    }
</style>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // 添加卡片悬停效果
    const cards = document.querySelectorAll('.feature-card');
    cards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-10px)';
            this.style.boxShadow = '0 10px 20px rgba(0,0,0,0.2)';
        });
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(-5px)';
            this.style.boxShadow = '0 0.5rem 1rem rgba(0, 0, 0, 0.15)';
        });
    });
    
    // BSR趋势图表
    var bsrCtx = document.getElementById('bsrTrendChart').getContext('2d');
    var bsrChart = new Chart(bsrCtx, {
        type: 'line',
        data: {
            labels: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'],
            datasets: [{
                label: '电子产品BSR趋势',
                data: [5000, 4800, 4600, 4200, 3900, 3600, 3300, 3000, 2700, 2500, 2300, 2100],
                lineTension: 0.3,
                backgroundColor: 'rgba(78, 115, 223, 0.05)',
                borderColor: 'rgba(78, 115, 223, 1)',
                pointRadius: 3,
                pointBackgroundColor: 'rgba(78, 115, 223, 1)',
                pointBorderColor: 'rgba(78, 115, 223, 1)',
                pointHoverRadius: 5,
                pointHoverBackgroundColor: 'rgba(78, 115, 223, 1)',
                pointHoverBorderColor: 'rgba(78, 115, 223, 1)',
                pointHitRadius: 10,
                pointBorderWidth: 2,
                fill: true
            }]
        },
        options: {
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    backgroundColor: 'rgb(255, 255, 255)',
                    bodyColor: '#858796',
                    titleColor: '#6e707e',
                    titleMarginBottom: 10,
                    titleFont: {
                        size: 14,
                        weight: 'bold'
                    },
                    borderColor: '#dddfeb',
                    borderWidth: 1,
                    padding: 15,
                    displayColors: false,
                    caretPadding: 10,
                    callbacks: {
                        label: function(context) {
                            return 'BSR排名: ' + context.parsed.y;
                        }
                    }
                }
            },
            scales: {
                y: {
                    reverse: true,
                    title: {
                        display: true,
                        text: 'BSR排名'
                    },
                    ticks: {
                        callback: function(value) {
                            return value;
                        }
                    }
                }
            }
        }
    });
    
    // 类目分布饼图
    var categoryCtx = document.getElementById('categoryPieChart').getContext('2d');
    var categoryChart = new Chart(categoryCtx, {
        type: 'doughnut',
        data: {
            labels: ['电子产品', '家居用品', '厨房用品', '运动户外', '美容个护', '其他'],
            datasets: [{
                data: [35, 25, 15, 10, 8, 7],
                backgroundColor: ['#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b', '#858796'],
                hoverBackgroundColor: ['#3a5acf', '#14a876', '#2aa1b3', '#e9b329', '#d93b2b', '#6f7388'],
                hoverBorderColor: 'rgba(234, 236, 244, 1)',
            }]
        },
        options: {
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                },
                tooltip: {
                    backgroundColor: 'rgb(255, 255, 255)',
                    bodyColor: '#858796',
                    titleColor: '#6e707e',
                    borderColor: '#dddfeb',
                    borderWidth: 1,
                    displayColors: false,
                    caretPadding: 10,
                    callbacks: {
                        label: function(context) {
                            var label = context.label || '';
                            var value = context.parsed || 0;
                            return label + ': ' + value + '%';
                        }
                    }
                }
            },
            cutout: '70%'
        }
    });
    
    // 评分分布条形图
    var ratingCtx = document.getElementById('ratingBarChart').getContext('2d');
    var ratingChart = new Chart(ratingCtx, {
        type: 'bar',
        data: {
            labels: ['5星', '4星', '3星', '2星', '1星'],
            datasets: [{
                label: '产品数量',
                data: [450, 320, 180, 60, 20],
                backgroundColor: [
                    'rgba(28, 200, 138, 0.8)',
                    'rgba(54, 185, 204, 0.8)',
                    'rgba(246, 194, 62, 0.8)',
                    'rgba(231, 74, 59, 0.8)',
                    'rgba(133, 135, 150, 0.8)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: '产品数量'
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });
});
</script>
{% endblock %} 